<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Create account form template
 *
 * @var $this Epicor_B2b_Block_Portal_Register
 */
$telephoneRequired = Mage::getStoreConfig('checkout/options/telephone_required');
$mobileNumberRequired = Mage::getStoreConfigFlag('customer/address/display_mobile_phone') && Mage::getStoreConfigFlag('checkout/options/mobile_number_required');

$registeredAddress = $this->showRegisteredAddress();
$registeredAddressTelephoneFax = $this->showRegisteredAddressTelephoneFax();

$invoiceAddress = $this->showInvoiceAddress();
$invoiceAddressTelephoneFax = $this->showInvoiceAddressTelephoneFax();

$deliveryAddress = $this->showDeliveryAddress();
$deliveryAddressTelephoneFax = $this->showDeliveryAddressTelephoneFax();

?>
<div class="account-create">    
    <div class="page-title">
        <h1><?php echo $this->__('Create a Business Account') ?></h1>
    </div>
    <?php echo $this->getChildHtml('form_fields_before') ?>
    <?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
    <?php /* Extensions placeholder */ ?>
    <?php echo $this->getChildHtml('customer.form.register.extra') ?>
    <form action="<?php echo $this->getPostActionUrl() ?>" method="post" id="form-validate">
        <div class="fieldset">
            <input type="hidden" name="success_url" value="<?php echo $this->getSuccessUrl() ?>" />
            <input type="hidden" name="error_url" value="<?php echo $this->getErrorUrl() ?>" />
          
            <h2 class="legend"><?php echo $this->__('Personal Information') ?></h2>
            <ul class="form-list">
                <li class="fields">
                    <?php echo $this->getLayout()->createBlock('customer/widget_name')->setObject($this->getFormData())->setForceUseCustomerAttributes(true)->toHtml() ?>
                </li>
                <li class="wide">
                    <label for="email_address" class="required"><em>*</em><?php echo $this->__('Email Address') ?></label>
                    <div class="input-box">
                        <input type="text" name="email" id="email_address" value="<?php echo $this->escapeHtml($this->getFormData()->getEmail()) ?>" title="<?php echo $this->__('Email Address') ?>" class="input-text validate-email required-entry" />
                    </div>
                </li>

                <?php if ($this->getSendAccountToErp() || !$this->getShowAddressFields()): ?>
                    <li class="wide">
                        <label for="company" class="required"><em>*</em><?php echo $this->__('Company') ?></label>
                        <div class="input-box">
                            <input type="text" name="company" id="company" value="<?php echo $this->escapeHtml($this->getFormData()->getCompany()) ?>" title="<?php echo $this->__('Company') ?>" class="input-text required-entry" />
                        </div>
                    </li>
                <?php endif; ?>

                <?php if ($this->showPreReg()): ?>
                    <li class="wide">
                        <label for="b2b_companyreg"><?php echo $this->__('Pre-Registered Password') ?></label>
                        <div class="input-box">
                            <input type="text" name="b2bcompanyreg" id="b2b_companyreg" value="<?php echo $this->escapeHtml($this->getFormData()->getB2bcompanyreg()) ?>" title="<?php echo $this->__('Pre Registered Password') ?>" class="input-text" />
                        </div>
                    </li>
                <?php endif; ?>

                <?php if ($this->isNewsletterEnabled()): ?>
                    <li class="control">
                        <div class="input-box">
                            <input type="checkbox" name="is_subscribed" title="<?php echo $this->__('Sign Up for Newsletter') ?>" value="1" id="is_subscribed"<?php if ($this->getFormData()->getIsSubscribed()): ?> checked="checked"<?php endif; ?> class="checkbox" />
                        </div>
                        <label for="is_subscribed"><?php echo $this->__('Sign Up for Newsletter') ?></label>
                        <?php /* Extensions placeholder */ ?>
                        <?php echo $this->getChildHtml('customer.form.register.newsletter') ?>
                    </li>
                <?php endif ?>
                <?php $_dob = $this->getLayout()->createBlock('customer/widget_dob') ?>
                <?php if ($_dob->isEnabled()): ?>
                    <li><?php echo $_dob->setDate($this->getFormData()->getDob())->toHtml() ?></li>
                <?php endif ?>
                <?php $_taxvat = $this->getLayout()->createBlock('customer/widget_taxvat') ?>
                <?php if ($_taxvat->isEnabled()): ?>
                    <li><?php echo $_taxvat->setTaxvat($this->getFormData()->getTaxvat())->toHtml() ?></li>
                <?php endif ?>
                <?php $_gender = $this->getLayout()->createBlock('customer/widget_gender') ?>
                <?php if ($_gender->isEnabled()): ?>
                    <li><?php echo $_gender->setGender($this->getFormData()->getGender())->toHtml() ?></li>
                <?php endif ?>
            </ul>
        </div>
        <?php if (!$this->getSendAccountToErp()): ?>
            <?php if ($this->getShowAddressFields()): ?>
                <div class="fieldset">
                    <input type="hidden" name="create_address" value="1" />
                    <h2 class="legend"><?php echo $this->__('Address Information') ?></h2>
                    <ul class="form-list">
                        <li class="fields">
                            <div class="field">
                                <label for="company"class="required"><em>*</em><?php echo $this->__('Company') ?></label>
                                <div class="input-box">
                                    <input type="text" name="company" id="company" value="<?php echo $this->escapeHtml($this->getFormData()->getCompany()) ?>" title="<?php echo $this->__('Company') ?>" class="input-text required-entry<?php echo $this->helper('customer/address')->getAttributeValidationClass('company') ?>" />
                                </div>
                            </div>
                        </li>   
                        <li class="fields">
                            <div class="field">
                                    <?php if ($telephoneRequired) { ?>
                                        <label for="telephone" class="required"><em>*</em><?php echo $this->__('Telephone') ?></label>
                                        <div class="input-box">
                                            <input type="text" name="telephone" id="telephone" value="<?php echo $this->escapeHtml($this->getFormData()->getTelephone()) ?>" title="<?php echo $this->__('Telephone') ?>" class="input-text required-entry" />
                                        </div>
                                    <?php } else { ?>
                                        <label for="telephone" ><?php echo $this->__('Telephone') ?></label>
                                        <div class="input-box">
                                            <input type="text" name="telephone" id="telephone" value="<?php echo $this->escapeHtml($this->getFormData()->getTelephone()) ?>" title="<?php echo $this->__('Telephone') ?>" class="input-text" />
                                        </div>
                                    <?php } ?>
                            </div>
                            <?php if ($this->displayMobilePhone()) : ?>
                                <div class="field">
                                        <?php if ($mobileNumberRequired) { ?>
                                            <label for="mobile_number" class="required"><em>*</em><?php echo $this->__('Mobile2') ?></label>
                                            <div class="input-box">
                                                <input type="text" name="mobile_number" id="mobile_number" value="<?php echo $this->escapeHtml($this->getFormData()->getMobileNumber()) ?>" title="<?php echo $this->__('Mobile') ?>" class="input-text required-entry" />
                                            </div>
                                        <?php } else { ?>
                                            <label for="mobile_number" ><?php echo $this->__('Mobile') ?></label>
                                            <div class="input-box">
                                                <input type="text" name="mobile_number" id="mobile_number" value="<?php echo $this->escapeHtml($this->getFormData()->getMobileNumber()) ?>" title="<?php echo $this->__('Mobile') ?>" class="input-text" />
                                            </div>
                                        <?php } ?>
                                </div>
                            <?php endif ?>
                        </li>
                        <?php $_streetValidationClass = $this->helper('customer/address')->getAttributeValidationClass('street'); ?>
                        <li class="wide">
                            <label for="street_1" class="required"><em>*</em><?php echo $this->__('Street Address') ?></label>
                            <div class="input-box">
                                <input type="text" name="street[]" value="<?php echo $this->escapeHtml($this->getFormData()->getStreet(1)) ?>" title="<?php echo $this->__('Street Address') ?>" id="street_1" class="input-text <?php echo $_streetValidationClass ?>" />
                            </div>
                        </li>
                        <?php for ($_i = 2, $_n = $this->helper('customer/address')->getStreetLines(); $_i <= $_n; $_i++): ?>
                            <li class="wide">
                                <div class="input-box">
                                    <input type="text" name="street[]" value="<?php echo $this->escapeHtml($this->getFormData()->getStreet($_i)) ?>" title="<?php echo $this->__('Street Address %s', $_i) ?>" id="street_<?php echo $_i ?>" class="input-text" />
                                </div>
                            </li>
                        <?php endfor; ?>
                        <li class="fields">
                            <div class="field">
                                <label for="city" class="required"><em>*</em><?php echo $this->__('City') ?></label>
                                <div class="input-box">
                                    <input type="text" name="city" value="<?php echo $this->escapeHtml($this->getFormData()->getCity()) ?>" title="<?php echo $this->__('City') ?>" class="input-text <?php echo $this->helper('customer/address')->getAttributeValidationClass('city') ?>" id="city" />
                                </div>
                            </div>
                            <div class="field">
                                <label for="region_id" class="required"><em>*</em><?php echo $this->__('State/Province') ?></label>
                                <div class="input-box">
                                    <select id="region_id" name="region_id" title="<?php echo $this->__('State/Province') ?>" class="validate-select" style="display:none;">
                                        <option value=""><?php echo $this->__('Please select region, state or province') ?></option>
                                    </select>
                                    <script type="text/javascript">
                                        //<![CDATA[
                                        $('region_id').setAttribute('defaultValue', "<?php echo $this->getFormData()->getRegionId() ?>");
                                        //]]>
                                    </script>
                                    <input type="text" id="region" name="region" value="<?php echo $this->escapeHtml($this->getRegion()) ?>" title="<?php echo $this->__('State/Province') ?>" class="input-text <?php echo $this->helper('customer/address')->getAttributeValidationClass('region') ?>" style="display:none;" />
                                </div>
                            </div>
                        </li>
                        <li class="fields">
                            <div class="field">
                                <label for="zip" class="required"><em>*</em><?php echo $this->__('Zip/Postal Code') ?></label>
                                <div class="input-box">
                                    <input type="text" name="postcode" value="<?php echo $this->escapeHtml($this->getFormData()->getPostcode()) ?>" title="<?php echo $this->__('Zip/Postal Code') ?>" id="zip" class="input-text validate-zip-international <?php echo $this->helper('customer/address')->getAttributeValidationClass('postcode') ?>" />
                                </div>
                            </div>
                            <div class="field">
                                <label for="country" class="required"><em>*</em><?php echo $this->__('Country') ?></label>
                                <div class="input-box">
                                    <?php echo $this->getCountryHtmlSelect() ?>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <input type="hidden" name="default_billing" value="1" />
                    <input type="hidden" name="default_shipping" value="1" />
                </div>
            <?php endif;
            else: 
                if($registeredAddress):
            ?>
            <div class="fieldset">
                <?php $address = $this->getFormData()->getRegistered(); ?>
                <h2 class="legend"><?php echo $this->__('Registered Address') ?></h2>
                <ul class="form-list">
                    <li class="wide">
                        <label for="registered_name"class="required"><em>*</em><?php echo $this->__('Name') ?></label>
                        <div class="input-box">
                            <input type="text" name="registered[name]" id="registered_name" value="<?php echo $this->escapeHtml(@$address['name']) ?>" title="<?php echo $this->__('Name') ?>" class="input-text required-entry" />
                        </div>
                    </li>
                    <?php $_streetValidationClass = $this->helper('customer/address')->getAttributeValidationClass('street'); ?>
                    <li class="wide">
                        <label for="registered_address_1" class="required"><em>*</em><?php echo $this->__('Street Address') ?></label>
                        <div class="input-box">
                            <input type="text" name="registered[address1]" value="<?php echo $this->escapeHtml(@$address['address1']) ?>" title="<?php echo $this->__('Street Address') ?>" id="registered_address_1" class="input-text <?php echo $_streetValidationClass ?>" />
                        </div>
                    </li>
                    <?php for ($_j = 2, $_m = $this->helper('customer/address')->getStreetLines(); $_j <= $_m; $_j++): ?>
                    <?php $addressX = 'address'.$_j; ?>
                        <li class="wide">
                            <div class="input-box">
                                <!--<input type="text" name="street[]" value="<?php //echo $this->escapeHtml($this->getFormData()->getStreet($_i)) ?>" title="<?php //echo $this->__('Street Address %s', $_i) ?>" id="street_<?php //echo $_i ?>" class="input-text <?php //echo $_streetValidationClass ?>" />-->
                                <input type="text" name="registered[<?php echo $addressX ?>]" value="<?php echo $this->escapeHtml(@$address[$addressX]) ?>" title="<?php echo $this->__("Street Address {$_j}") ?>" id="registered_address_<?php echo $_j ?>" class="input-text" />
                  
                            </div>
                        </li>
                    <?php endfor; ?>                   
                    <li class="fields">
                        <div class="field">
                            <label for="registered_city" class="required"><em>*</em><?php echo $this->__('City') ?></label>
                            <div class="input-box">
                                <input type="text" name="registered[city]" value="<?php echo $this->escapeHtml(@$address['city']) ?>" title="<?php echo $this->__('City') ?>" class="input-text <?php echo $this->helper('customer/address')->getAttributeValidationClass('city') ?>" id="registered_city" />
                            </div>
                        </div>
                        <div class="field">
                            <label for="registered_county_id" class="required"><em>*</em><?php echo $this->__('State/Province') ?></label>
                            <div class="input-box">
                                <select id="registered_county_id" name="registered[county_id]" title="<?php echo $this->__('State/Province') ?>" class="validate-select" style="display:none;">
                                    <option value=""><?php echo $this->__('Please select county, state or province') ?></option>
                                </select>
                                <script type="text/javascript">
                                    //<![CDATA[
                                    $('registered_county_id').setAttribute('defaultValue', "<?php echo @$address['county_id'] ?>");
                                    //]]>
                                </script>
                                <input type="text" id="registered_county" name="registered[county]" value="<?php echo $this->escapeHtml(@$address['county']) ?>" title="<?php echo $this->__('State/Province') ?>" class="input-text <?php echo $this->helper('customer/address')->getAttributeValidationClass('county') ?>" style="display:none;" />
                            </div>
                        </div>
                    </li>
                    <li class="fields">
                        <div class="field">
                            <label for="registered_zip" class="required"><em>*</em><?php echo $this->__('Zip/Postal Code') ?></label>
                            <div class="input-box">
                                <input type="text" name="registered[postcode]" value="<?php echo $this->escapeHtml(@$address['postcode']) ?>" title="<?php echo $this->__('Zip/Postal Code') ?>" id="registered_zip" class="input-text validate-zip-international <?php echo $this->helper('customer/address')->getAttributeValidationClass('postcode') ?>" />
                            </div>
                        </div>
                        <div class="field">
                            <label for="registered_country" class="required"><em>*</em><?php echo $this->__('Country') ?></label>
                            <div class="input-box">
                                <?php echo $this->getCountryHtmlSelect(null, 'registered[country]', 'registered_country') ?>
                            </div>
                        </div>
                    </li>
                    <?php if ($registeredAddressTelephoneFax) : ?>
                    <li class="fields">
                        <div class="field">
                            <?php if ($telephoneRequired) { ?>
                                <label for="telephone" class="required"><em>*</em><?php echo $this->__('Telephone') ?></label>
                                <div class="input-box">
                                    <input type="text" name="registered[phone]" id="registered_phone" value="<?php echo $this->escapeHtml(@$address['phone']) ?>" title="<?php echo $this->__('Telephone') ?>" class="input-text  required-entry" />
                                </div>
                            <?php } else { ?>
                                <label for="telephone" ><?php echo $this->__('Telephone') ?></label>
                                <div class="input-box">
                                     <input type="text" name="registered[phone]" id="registered_phone" value="<?php echo $this->escapeHtml(@$address['phone']) ?>" title="<?php echo $this->__('Telephone') ?>" class="input-text" />
                                </div>
                            <?php } ?>                            
                        </div>
                        <div class="field">
                            <?php if ($this->displayMobilePhone()) : ?>
                                <?php if ($mobileNumberRequired) { ?>
                                    <label for="mobile_number" class="required"><em>*</em><?php echo $this->__('Mobile') ?></label>
                                    <div class="input-box">
                                        <input type="text" name="registered[mobile_number]" id="registered_mobile_number" value="<?php echo $this->escapeHtml(@$address['mobile_number']) ?>" title="<?php echo $this->__('Mobile') ?>" class="input-text  required-entry" />
                                    </div>
                                <?php } else { ?>
                                    <label for="mobile_number" ><?php echo $this->__('Mobile') ?></label>
                                     <div class="input-box">
                                        <input type="text" name="registered[mobile_number]" id="registered_mobile_number" value="<?php echo $this->escapeHtml(@$address['mobile_number']) ?>" title="<?php echo $this->__('Mobile') ?>" class="input-text" />
                                    </div>                               
                                <?php } ?>                            
                            <?php endif ?>                            
                        </div>
                    </li>    
                    <li class="fields">    
                        <div class="field">
                            <label for="registered_fax_number"><?php echo $this->__('Fax Number') ?></label>
                            <div class="input-box">
                                <input type="text" name="registered[fax_number]" id="registered_fax_number" value="<?php echo $this->escapeHtml(@$address['fax_number']) ?>" title="<?php echo $this->__('Fax') ?>" class="input-text" />
                            </div>
                        </div>
                    </li>
                    <?php endif; ?>
                </ul>
            </div>
        <?php
            endif;
            if($invoiceAddress):
        ?>
            <div class="fieldset">
                <?php $address = $this->getFormData()->getInvoice(); ?>
                <h2 class="legend"><?php echo $this->__('Invoice Address') ?></h2>
                <ul class="form-list">
                    <?php
                        if($registeredAddress):
                    ?>
                    <li class="wide">
                        <p>
                            <input type="checkbox" name="same_as" value="1" id="registered_invoice" class="same_as" />
                            <label for="registered_invoice"class="required"><?php echo $this->__('Same as Registered Address') ?></label>
                        </p>
                    </li>
                    <?php
                        endif;
                    ?>                    
                    <li class="wide">
                        <label for="invoice_name"class="required"><em>*</em><?php echo $this->__('Name') ?></label>
                        <div class="input-box">
                            <input type="text" name="invoice[name]" id="invoice_name" value="<?php echo $this->escapeHtml(@$address['name']) ?>" title="<?php echo $this->__('Name') ?>" class="input-text required-entry" />
                        </div>
                    </li>
                    <?php $_streetValidationClass = $this->helper('customer/address')->getAttributeValidationClass('street'); ?>
                    <li class="wide">
                        <label for="invoice_address_1" class="required"><em>*</em><?php echo $this->__('Street Address') ?></label>
                        <div class="input-box">
                            <input type="text" name="invoice[address1]" value="<?php echo $this->escapeHtml(@$address['address1']) ?>" title="<?php echo $this->__('Street Address') ?>" id="invoice_address_1" class="input-text <?php echo $_streetValidationClass ?>" />
                        </div>
                    </li>
                    <?php for ($_k = 2, $_p = $this->helper('customer/address')->getStreetLines(); $_k <= $_p; $_k++): ?>
                    <?php $addressY = 'address'.$_k; ?>
                        <li class="wide">
                            <div class="input-box">
                                <input type="text" name="invoice[<?php echo $addressY ?>]" value="<?php echo $this->escapeHtml(@$address[$addressY]) ?>" title="<?php echo $this->__("Street Address {$_k}") ?>" id="invoice_address_<?php echo $_k ?>" class="input-text" />
                            </div>
                        </li>
                    <?php endfor; ?>   
                    <li class="fields">
                        <div class="field">
                            <label for="invoice_city" class="required"><em>*</em><?php echo $this->__('City') ?></label>
                            <div class="input-box">
                                <input type="text" name="invoice[city]" value="<?php echo $this->escapeHtml(@$address['city']) ?>" title="<?php echo $this->__('City') ?>" class="input-text <?php echo $this->helper('customer/address')->getAttributeValidationClass('city') ?>" id="invoice_city" />
                            </div>
                        </div>
                        <div class="field">
                            <label for="invoice_county_id" class="required"><em>*</em><?php echo $this->__('State/Province') ?></label>
                            <div class="input-box">
                                <select id="invoice_county_id" name="invoice[county_id]" title="<?php echo $this->__('State/Province') ?>" class="validate-select" style="display:none;">
                                    <option value=""><?php echo $this->__('Please select county, state or province') ?></option>
                                </select>
                                <script type="text/javascript">
                                    //<![CDATA[
                                    $('invoice_county_id').setAttribute('defaultValue', "<?php echo @$address['county_id'] ?>");
                                    //]]>
                                </script>
                                <input type="text" id="invoice_county" name="invoice[county]" value="<?php echo $this->escapeHtml(@$address['county']) ?>" title="<?php echo $this->__('State/Province') ?>" class="input-text <?php echo $this->helper('customer/address')->getAttributeValidationClass('county') ?>" style="display:none;" />
                            </div>
                        </div>
                    </li>
                    <li class="fields">
                        <div class="field">
                            <label for="invoice_zip" class="required"><em>*</em><?php echo $this->__('Zip/Postal Code') ?></label>
                            <div class="input-box">
                                <input type="text" name="invoice[postcode]" value="<?php echo $this->escapeHtml(@$address['postcode']) ?>" title="<?php echo $this->__('Zip/Postal Code') ?>" id="invoice_zip" class="input-text validate-zip-international <?php echo $this->helper('customer/address')->getAttributeValidationClass('postcode') ?>" />
                            </div>
                        </div>
                        <div class="field">
                            <label for="invoice_country" class="required"><em>*</em><?php echo $this->__('Country') ?></label>
                            <div class="input-box">
                                <?php echo $this->getCountryHtmlSelect(null, 'invoice[country]', 'invoice_country') ?>
                            </div>
                        </div>
                    </li>
                    <?php if ($invoiceAddressTelephoneFax) : ?>
                    <li class="fields">
                        <div class="field">
                             <?php if ($telephoneRequired) { ?>
                                <label for="telephone" class="required"><em>*</em><?php echo $this->__('Telephone') ?></label>
                                <div class="input-box">
                                    <input type="text" name="invoice[phone]" id="invoice_phone" value="<?php echo $this->escapeHtml(@$address['phone']) ?>" title="<?php echo $this->__('Telephone') ?>" class="input-text  required-entry" />
                                </div>
                            <?php } else { ?>
                                <label for="telephone" ><?php echo $this->__('Telephone') ?></label>
                                <div class="input-box">
                                     <input type="text" name="invoice[phone]" id="invoice_phone" value="<?php echo $this->escapeHtml(@$address['phone']) ?>" title="<?php echo $this->__('Telephone') ?>" class="input-text" />
                                </div>
                            <?php } ?>                                  
                        </div>
                        <div class="field">
                         <?php if ($this->displayMobilePhone()) : ?>   
                            <?php if ($mobileNumberRequired) { ?>
                                   <label for="mobile_number" class="required"><em>*</em><?php echo $this->__('Mobile') ?></label>
                                   <div class="input-box">
                                       <input type="text" name="invoice[mobile_number]" id="invoice_mobile_number" value="<?php echo $this->escapeHtml(@$address['mobile_number']) ?>" title="<?php echo $this->__('Mobile') ?>" class="input-text  required-entry" />
                                   </div>
                               <?php } else { ?>
                                   <label for="mobile_number" ><?php echo $this->__('Mobile') ?></label>
                                    <div class="input-box">
                                       <input type="text" name="invoice[mobile_number]" id="invoice_mobile_number" value="<?php echo $this->escapeHtml(@$address['mobile_number']) ?>" title="<?php echo $this->__('Mobile') ?>" class="input-text" />
                                   </div>                               
                               <?php } ?>  
                            <?php endif ?>                      
                         </div> 
                     </li>   
                     <li class="fields">    
                        <div class="field">
                            <label for="invoice_fax_number"><?php echo $this->__('Fax Number') ?></label>
                            <div class="input-box">
                                <input type="text" name="invoice[fax_number]" id="invoice_fax_number" value="<?php echo $this->escapeHtml(@$address['fax_number']) ?>" title="<?php echo $this->__('Fax') ?>" class="input-text" />
                            </div>
                        </div>
                    </li>
                    <?php endif; ?>
                </ul>
            </div>
        <?php
            endif;
            if($deliveryAddress):
        ?>
            <div class="fieldset">
                <?php $address = $this->getFormData()->getDelivery(); ?>

                <h2 class="legend"><?php echo $this->__('Delivery Address') ?></h2>
                <ul class="form-list">
                    <li class="wide">
                        <?php
                            if($registeredAddress):
                        ?>
                        <p>
                            <input type="checkbox" name="same_as" value="1" id="registered_delivery" class="same_as" onclick="selectOnlyOneCheckbox(id)"/>
                            <label for="registered_delivery"class="required"><?php echo $this->__('Same as Registered Address') ?></label>
                        </p>
                        <?php
                            endif;
                            if($invoiceAddress):
                        ?>
                        <p>
                            <input type="checkbox" name="same_as" value="1" id="invoice_delivery" class="same_as" onclick="selectOnlyOneCheckbox(id)"/>
                            <label for="invoice_delivery"class="required"><?php echo $this->__('Same as Invoice Address') ?></label>
                        </p>
                        <?php
                            endif;
                        ?>
                    </li>
                    <li class="wide">
                        <label for="delivery_name"class="required"><em>*</em><?php echo $this->__('Name') ?></label>
                        <div class="input-box">
                            <input type="text" name="delivery[name]" id="delivery_name" value="<?php echo $this->escapeHtml(@$address['name']) ?>" title="<?php echo $this->__('Name') ?>" class="input-text required-entry" />
                        </div>
                    </li>
                    <?php $_streetValidationClass = $this->helper('customer/address')->getAttributeValidationClass('street'); ?>
                    <li class="wide">
                        <label for="delivery_address_1" class="required"><em>*</em><?php echo $this->__('Street Address') ?></label>
                        <div class="input-box">
                            <input type="text" name="delivery[address1]" value="<?php echo $this->escapeHtml(@$address['address1']) ?>" title="<?php echo $this->__('Street Address') ?>" id="delivery_address_1" class="input-text <?php echo $_streetValidationClass ?>" />
                        </div>
                    </li>
                    <?php for ($_l = 2, $_r = $this->helper('customer/address')->getStreetLines(); $_l <= $_r; $_l++): ?>
                    <?php $addressZ = 'address'.$_l; ?>
                        <li class="wide">
                            <div class="input-box">
                                <input type="text" name="delivery[<?php echo $addressZ ?>]" value="<?php echo $this->escapeHtml(@$address[$addressZ]) ?>" title="<?php echo $this->__("Street Address {$_l}") ?>" id="delivery_address_<?php echo $_l ?>" class="input-text" />
                            </div>
                        </li>
                    <?php endfor; ?>                       
                    <li class="fields">
                        <div class="field">
                            <label for="delivery_city" class="required"><em>*</em><?php echo $this->__('City') ?></label>
                            <div class="input-box">
                                <input type="text" name="delivery[city]" value="<?php echo $this->escapeHtml(@$address['city']) ?>" title="<?php echo $this->__('City') ?>" class="input-text <?php echo $this->helper('customer/address')->getAttributeValidationClass('city') ?>" id="delivery_city" />
                            </div>
                        </div>
                        <div class="field">
                            <label for="delivery_county_id" class="required"><em>*</em><?php echo $this->__('State/Province') ?></label>
                            <div class="input-box">
                                <select id="delivery_county_id" name="delivery[county_id]" title="<?php echo $this->__('State/Province') ?>" class="validate-select" style="display:none;">
                                    <option value=""><?php echo $this->__('Please select county, state or province') ?></option>
                                </select>
                                <script type="text/javascript">
                                    //<![CDATA[
                                    $('delivery_county_id').setAttribute('defaultValue', "<?php echo @$address['county_id'] ?>");
                                    //]]>
                                </script>
                                <input type="text" id="delivery_county" name="delivery[county]" value="<?php echo $this->escapeHtml(@$address['county']) ?>" title="<?php echo $this->__('State/Province') ?>" class="input-text <?php echo $this->helper('customer/address')->getAttributeValidationClass('county') ?>" style="display:none;" />
                            </div>
                        </div>
                    </li>
                    <li class="fields">
                        <div class="field">
                            <label for="delivery_zip" class="required"><em>*</em><?php echo $this->__('Zip/Postal Code') ?></label>
                            <div class="input-box">
                                <input type="text" name="delivery[postcode]" value="<?php echo $this->escapeHtml(@$address['postcode']) ?>" title="<?php echo $this->__('Zip/Postal Code') ?>" id="delivery_zip" class="input-text validate-zip-international <?php echo $this->helper('customer/address')->getAttributeValidationClass('postcode') ?>" />
                            </div>
                        </div>
                        <div class="field">
                            <label for="delivery_country" class="required"><em>*</em><?php echo $this->__('Country') ?></label>
                            <div class="input-box">
                                <?php echo $this->getCountryHtmlSelect(null, 'delivery[country]', 'delivery_country') ?>
                            </div>
                        </div>
                    </li>
                    <?php if ($deliveryAddressTelephoneFax) : ?>
                    <li class="fields">
                        <div class="field">
                             <?php if ($telephoneRequired) { ?>
                                <label for="telephone" class="required"><em>*</em><?php echo $this->__('Telephone') ?></label>
                                <div class="input-box">
                                     <input type="text" name="delivery[phone]" id="delivery_phone" value="<?php echo $this->escapeHtml(@$address['phone']) ?>" title="<?php echo $this->__('Telephone') ?>" class="input-text  required-entry" />
                                </div>
                            <?php } else { ?>
                                <label for="telephone" ><?php echo $this->__('Telephone') ?></label>
                                <div class="input-box">
                                    <input type="text" name="delivery[phone]" id="delivery_phone" value="<?php echo $this->escapeHtml(@$address['phone']) ?>" title="<?php echo $this->__('Telephone') ?>" class="input-text" />
                                </div>
                            <?php } ?>                              
                        </div>
                         <div class="field">
                            <?php if ($this->displayMobilePhone()) : ?>    
                            <?php if ($mobileNumberRequired) { ?>
                                   <label for="mobile_number" class="required"><em>*</em><?php echo $this->__('Mobile') ?></label>
                                   <div class="input-box">
                                       <input type="text" name="delivery[mobile_number]" id="delivery_mobile_number" value="<?php echo $this->escapeHtml(@$address['mobile_number']) ?>" title="<?php echo $this->__('Mobile') ?>" class="input-text  required-entry" />
                                   </div>
                               <?php } else { ?>
                                   <label for="mobile_number" ><?php echo $this->__('Mobile') ?></label>
                                    <div class="input-box">
                                       <input type="text" name="delivery[mobile_number]" id="delivery_mobile_number" value="<?php echo $this->escapeHtml(@$address['mobile_number']) ?>" title="<?php echo $this->__('Mobile') ?>" class="input-text" />
                                   </div>                               
                               <?php } ?>  
                            <?php endif ?>                      
                         </div> 
                     </li>   
                     <li class="fields">    
                        <div class="field">
                            <label for="delivery_fax_number"><?php echo $this->__('Fax Number') ?></label>
                            <div class="input-box">
                                <input type="text" name="delivery[fax_number]" id="delivery_fax_number" value="<?php echo $this->escapeHtml(@$address['fax_number']) ?>" title="<?php echo $this->__('Fax') ?>" class="input-text" />
                            </div>
                        </div>
                    </li>
                    <?php endif; ?>
                    <?php if ($this->displayInstructions()) : ?>    
                        <li class="wide">
                            <div class="input-box">
                                <label for="delivery_instructions"><?php echo $this->__('Instructions') ?></label>
                                <div class="input-box">
                                    <textarea type="text" name="delivery[instructions]" id="delivery_instructions" title="<?php echo $this->__('Instructions') ?>" class="input-text" ><?php echo $this->escapeHtml(@$address['instructions']) ?></textarea>
                                </div>
                            </div>
                        </li>
                    <?php endif; ?>
                        
                </ul>
            </div>
        <?php 
                endif;
            endif;
        ?>
        <?php if ($this->showPasswordField()): ?>
            <div class="fieldset">
                <h2 class="legend"><?php echo $this->__('Login Information') ?></h2>
                <ul class="form-list">
                    <li class="fields">
                        <div class="field">
                            <label for="password" class="required"><em>*</em><?php echo $this->__('Password') ?></label>
                            <div class="input-box">
                                <input type="password" name="password" id="password" title="<?php echo $this->__('Password') ?>" class="input-text required-entry validate-password" />
                            </div>
                        </div>
                        <div class="field">
                            <label for="confirmation" class="required"><em>*</em><?php echo $this->__('Confirm Password') ?></label>
                            <div class="input-box">
                                <input type="password" name="confirmation" title="<?php echo $this->__('Confirm Password') ?>" id="confirmation" class="input-text required-entry validate-cpassword" />
                            </div>
                        </div>
                    </li>
                    <?php echo $this->getChildHtml('form.additional.info'); ?>
                </ul>
            </div>
        <?php endif; ?>
        <div class="buttons-set">
            <p class="required"><?php echo $this->__('* Required Fields') ?></p>
            <p class="back-link"><a href="<?php echo $this->escapeUrl($this->getBackUrl()) ?>" class="back-link"><small>&laquo; </small><?php echo $this->__('Back') ?></a></p>
            <button type="submit" title="<?php echo $this->__('Submit') ?>" class="button"><span><span><?php echo $this->__('Submit') ?></span></span></button>
        </div>
    </form>
    <script type="text/javascript">
        //<![CDATA[
        var dataForm = new VarienForm('form-validate', true);
<?php if (!$this->getSendAccountToErp()): ?>
    <?php if ($this->getShowAddressFields()): ?>
                new RegionUpdater('country', 'region', 'region_id', <?php echo $this->helper('directory')->getRegionJson() ?>, undefined, 'zip');
    <?php endif; ?>
<?php else: ?>
            
            <?php if($registeredAddress):?> new RegionUpdater('registered_country', 'registered_county', 'registered_county_id', <?php echo $this->helper('directory')->getRegionJson() ?>, undefined, 'registered_zip');<?php endif;?>
            <?php if($invoiceAddress):?> new RegionUpdater('invoice_country', 'invoice_county', 'invoice_county_id', <?php echo $this->helper('directory')->getRegionJson() ?>, undefined, 'invoice_zip');<?php endif;?>
            <?php if($deliveryAddress):?> new RegionUpdater('delivery_country', 'delivery_county', 'delivery_county_id', <?php echo $this->helper('directory')->getRegionJson() ?>, undefined, 'delivery_zip');<?php endif; ?>
            var street_lines = <?php echo $this->helper('customer/address')->getStreetLines() ?>;

            function blankAddress(type) {
                $(type + '_name').value = '';
                $(type + '_address_1').value = '';
                j = 0;
                for (j = 2; j <= street_lines; j++) { 
                    if((typeof($(type + '_address_'+ j) !='undefined') && $(type + '_address_' + j) != null)){
                        $(type + '_address_' + j).value = '';
                     }
                }
                                 
                $(type + '_city').value = '';
                $(type + '_county_id').show();
                $(type + '_county_id').value = '';
                $(type + '_county').hide();
                $(type + '_county').value = '';
                $(type + '_zip').value = '';
                $(type + '_country').value = '';
                $(type + '_phone').value = '';
                $(type + '_mobile_number').value = '';
                $(type + '_fax_number').value = '';
            }
            function sameAddressAs(from, to) {
                $(to + '_name').value = $(from + '_name').value;
                $(to + '_address_1').value = $(from + '_address_1').value;
                i= 0;
                for (i = 2; i <= street_lines; i++) { 
                    if((typeof($(to + '_address_'+ i) !='undefined') && $(to + '_address_' + i) != null)){
                         $(to + '_address_' + i).value = $(from + '_address_' + i).value;
                     }
                } 
                $(to + '_city').value = $(from + '_city').value;
                if($(from + '_county_id').visible()){
                    $(to + '_county_id').show();
                } else {
                    $(to + '_county_id').hide();
                }
                $(to + '_county_id').value = $(from + '_county_id').value;
                if($(from + '_county').visible()){
                    $(to + '_county').show();
                } else {
                    $(to + '_county').hide();
                }
               
                $(to + '_county').value = $(from + '_county').value;
                $(to + '_zip').value = $(from + '_zip').value;
                $(to + '_country').value = $(from + '_country').value;
                if((typeof($(to + '_phone') != 'undefined') &&  $(to + '_phone') != null)) {
                    $(to + '_phone').value = $(from + '_phone').value;
                }    
                if((typeof($(to + '_mobile_number') != 'undefined') &&  $(to + '_mobile_number') != null)) {
                    $(to + '_mobile_number').value = $(from + '_mobile_number').value;
                }    
                if((typeof($(to + '_fax_number') != 'undefined') && $(to + '_fax_number') != null)) {
                    $(to + '_fax_number').value = $(from + '_fax_number').value;
                }
                if($(to +'_county').value == ""){
                    $(to +'_county').removeClassName('required-entry');   
                    $$('label[for="' + to + '_county_id"] em').first().update('');  
                } 
            }
            //ensure only one checkbox is ticked in delivery address
             function selectOnlyOneCheckbox(id) {
                 if(id == 'registered_delivery'){
                    $('invoice_delivery').checked = false;
                 }else{
                    $('registered_delivery').checked = false; 
                 }
             }

            document.observe('dom:loaded', function() {

                $('form-validate').select('.same_as').invoke('observe', 'click', function() {
                    split = this.readAttribute('id').split('_');
                    var from = split[0];
                    var to = split[1];
                    if (this.checked) {
                        sameAddressAs(from, to);
                    } 
                    //remove functionality that blanks out fields if checkbox unchecked
//                    else {
//                        blankAddress(to);
//                    }
                });
                
                $('invoice_country').observe('change', function(a){
                    if($('invoice_county').value == ""){
                        $('invoice_county').removeClassName('required-entry'); 
                    }else{
                        $('invoice_county').addClassName('required-entry');                         
                    }    
                      $$('label[for="invoice_county_id"] em').first().update('*');  
                })
                $('delivery_country').observe('change', function(a){
                     if($('delivery_county').value == ""){
                        $('delivery_county').removeClassName('required-entry');   
                     }else{
                        $('delivery_county').addClassName('required-entry');   
                     }
                    $$('label[for="delivery_county_id"] em').first().update('*');  
                })  
            });
<?php endif; ?>   
    <?php if(Mage::getStoreConfigFlag('customer/address/limits_enabled')){ ?>
        var limitcheck = new checkLengthLimits( <?php echo Mage::getStoreConfig('customer/address/limit_name_length') ? Mage::getStoreConfig('customer/address/limit_name_length') : 10234 ?> 
                                       ,<?php echo Mage::getStoreConfig('customer/address/limit_address_line_length') ? Mage::getStoreConfig('customer/address/limit_address_line_length') : 10234  ?> 
                                       ,<?php echo Mage::getStoreConfig('customer/address/limit_telephone_length') ? Mage::getStoreConfig('customer/address/limit_telephone_length') : 10234 ?> 
                                       ,<?php echo Mage::getStoreConfig('customer/address/limit_instructions_length') ? Mage::getStoreConfig('customer/address/limit_instructions_length') : 10234 ?> 
                                   );
    <?php } ?>    
        //]]>
    </script>
</div>
